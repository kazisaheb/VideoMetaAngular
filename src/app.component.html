<div class="min-h-screen w-full bg-[rgb(17,24,39)] p-4 sm:p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">
    
    <!-- Header -->
    <header class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold text-white tracking-tight">Bulk Video Metadata Generator</h1>
      <p class="mt-2 text-lg text-[rgb(156,163,175)]">Upload your videos to automatically generate titles and keywords with AI.</p>
    </header>

    @if (apiKeyMissing()) {
      <div class="bg-[rgb(75,85,99)] border-l-4 border-[rgb(239,68,68)] text-white p-4 rounded-md shadow-lg" role="alert">
        <p class="font-bold">Configuration Error</p>
        <p>The Gemini API key is not configured. Please set the <code class="bg-[rgb(31,41,55)] px-1 rounded">API_KEY</code> environment variable to proceed.</p>
      </div>
    }

    <!-- Controls -->
    <div class="bg-[rgb(31,41,55)] p-6 rounded-lg shadow-lg mb-8 sticky top-4 z-10 border border-[rgb(55,65,81)]">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
        <!-- File Upload -->
        <div>
          <label for="video-upload" class="block text-sm font-medium text-[rgb(209,213,219)] mb-2">Select Video Files</label>
          <label class="w-full flex items-center justify-center px-4 py-3 border-2 border-dashed border-[rgb(75,85,99)] rounded-md cursor-pointer hover:border-[rgb(20,184,166)] transition-colors duration-300"
                 [class.opacity-50]="isProcessing()">
            <svg class="w-8 h-8 text-[rgb(156,163,175)]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
            <span class="ml-3 text-[rgb(156,163,175)]">Click to upload videos</span>
            <input id="video-upload" type="file" multiple accept="video/*" class="hidden" (change)="onFileSelected($event)" [disabled]="isProcessing()">
          </label>
        </div>

        <!-- Action Buttons -->
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
          <button (click)="pauseProcessing()" [disabled]="!canPause()" class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-[rgb(59,130,246)] text-white hover:bg-[rgb(37,99,235)] disabled:bg-[rgb(55,65,81)] disabled:text-[rgb(107,114,128)] disabled:cursor-not-allowed">Pause</button>
          <button (click)="resumeProcessing()" [disabled]="!canResume()" class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-[rgb(16,185,129)] text-white hover:bg-[rgb(5,150,105)] disabled:bg-[rgb(55,65,81)] disabled:text-[rgb(107,114,128)] disabled:cursor-not-allowed">Resume</button>
          <button (click)="stopProcessing()" [disabled]="!canStop()" class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-[rgb(239,68,68)] text-white hover:bg-[rgb(220,38,38)] disabled:bg-[rgb(55,65,81)] disabled:text-[rgb(107,114,128)] disabled:cursor-not-allowed">Stop</button>
          <button (click)="retryFailed()" [disabled]="!canRetry()" class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-[rgb(245,158,11)] text-white hover:bg-[rgb(217,119,6)] disabled:bg-[rgb(55,65,81)] disabled:text-[rgb(107,114,128)] disabled:cursor-not-allowed">Retry Failed</button>
          <button (click)="clearAll()" [disabled]="!canClear()" class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-[rgb(107,114,128)] text-white hover:bg-[rgb(75,85,99)] disabled:bg-[rgb(55,65,81)] disabled:text-[rgb(107,114,128)] disabled:cursor-not-allowed">Clear All</button>
          <button (click)="downloadCSV()" [disabled]="!canDownload()" class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-[rgb(20,184,166)] text-white hover:bg-[rgb(13,148,136)] disabled:bg-[rgb(55,65,81)] disabled:text-[rgb(107,114,128)] disabled:cursor-not-allowed">Download CSV</button>
        </div>
      </div>
      
      <!-- Progress Bar -->
      @if (videos().length > 0) {
        <div class="mt-6">
          <div class="flex justify-between mb-1">
            <span class="text-base font-medium text-[rgb(209,213,219)]">Processing Videos</span>
            <span class="text-base font-medium text-[rgb(209,213,219)]">{{ currentIndex() }} / {{ videos().length }}</span>
          </div>
          <div class="w-full bg-[rgb(55,65,81)] rounded-full h-2.5">
            <div class="bg-[rgb(20,184,166)] h-2.5 rounded-full transition-all duration-300" [style.width.%]="progress()"></div>
          </div>
        </div>
      }
    </div>

    <!-- Video List -->
    <div class="space-y-6">
      @for (video of videos(); track video.id) {
        <div class="bg-[rgb(31,41,55)] p-4 rounded-lg shadow-md border border-[rgb(55,65,81)] flex flex-col sm:flex-row gap-6">
          
          <!-- Thumbnail -->
          <div class="flex-shrink-0 w-full sm:w-64 h-36 bg-[rgb(17,24,39)] rounded-md flex items-center justify-center overflow-hidden">
            @if (video.thumbnail) {
              <img [src]="video.thumbnail" alt="Video thumbnail" class="object-cover w-full h-full">
            } @else {
              <div class="text-[rgb(107,114,128)]">Generating...</div>
            }
          </div>

          <!-- Content -->
          <div class="flex-grow">
            <div class="flex justify-between items-start">
              <h3 class="font-semibold text-lg text-white truncate pr-2" [title]="video.file.name">{{ video.file.name }}</h3>
              <span class="text-sm font-medium px-2.5 py-0.5 rounded-full"
                [class.bg-[rgb(59,130,246)]]="video.status === 'processing'"
                [class.bg-[rgb(16,185,129)]]="video.status === 'completed'"
                [class.bg-[rgb(239,68,68)]]="video.status === 'failed'"
                [class.bg-[rgb(107,114,128)]]="video.status === 'pending'"
                [class.text-white]="true">
                {{ video.status }}
              </span>
            </div>

            @switch (video.status) {
              @case ('processing') {
                <div class="flex items-center mt-2 text-base text-[rgb(156,163,175)]">
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <span>Generating metadata...</span>
                </div>
              }
              @case ('completed') {
                <div class="mt-2 space-y-4">
                  <div>
                    <div class="flex justify-between items-center">
                      <label class="text-base font-medium text-[rgb(209,213,219)]">Title</label>
                      <button (click)="copyToClipboard(video.title, 'title', video.id)" class="text-sm text-[rgb(20,184,166)] hover:text-[rgb(13,148,136)] transition-colors">
                        {{ copiedState()[video.id + '-title'] ? 'Copied!' : 'Copy' }}
                      </button>
                    </div>
                    <p class="mt-1 text-base bg-[rgb(17,24,39)] p-3 rounded-md text-[rgb(209,213,219)]">{{ video.title }}</p>
                  </div>
                  <div>
                    <div class="flex justify-between items-center">
                      <label class="text-base font-medium text-[rgb(209,213,219)]">Keywords</label>
                      <button (click)="copyToClipboard(video.keywords, 'keywords', video.id)" class="text-sm text-[rgb(20,184,166)] hover:text-[rgb(13,148,136)] transition-colors">
                        {{ copiedState()[video.id + '-keywords'] ? 'Copied!' : 'Copy' }}
                      </button>
                    </div>
                    <p class="mt-1 text-base bg-[rgb(17,24,39)] p-3 rounded-md text-[rgb(209,213,219)] max-h-24 overflow-y-auto">
                      {{ video.keywords.join(', ') }}
                    </p>
                  </div>
                </div>
              }
              @case ('failed') {
                <div class="mt-2 text-base text-red-400 bg-[rgb(75,85,99)] p-3 rounded-md">
                  <strong>Error:</strong> {{ video.errorMessage }}
                </div>
              }
              @case ('pending') {
                <div class="mt-2 text-base text-[rgb(156,163,175)]">
                  Waiting in queue...
                </div>
              }
            }
          </div>

        </div>
      } @empty {
        <div class="text-center py-16 border-2 border-dashed border-[rgb(55,65,81)] rounded-lg">
          <svg class="mx-auto h-12 w-12 text-[rgb(107,114,128)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
          </svg>
          <h3 class="mt-2 text-lg font-medium text-white">No videos uploaded</h3>
          <p class="mt-1 text-base text-[rgb(156,163,175)]">Get started by uploading some video files.</p>
        </div>
      }
    </div>
  </div>
</div>